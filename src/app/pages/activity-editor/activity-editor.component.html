<div class="activity-editor-container">
    <button mat-flat-button
            class="save-button"
            (click)="handleSave()"
            [disabled]="isLoading">
      <mat-icon>save</mat-icon>
      <span>Save Activity</span>
    </button>
  

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="60" class="spinner"></mat-spinner>
    <p class="loading-text">Loading activity editor...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && activity" class="main-content">
    
    <!-- Left Column: Activity Form -->
    <div class="left-panel">
      <div class="panel-card">
        <div class="panel-header">
          <h2 class="panel-title">
            <mat-icon>edit</mat-icon>
            Activity Details
          </h2>
        </div>
        <div class="panel-body">
          <app-activity-form
            [activityData]="activity"
            [mainActivities]="mainActivities"
            [activityTypes]="getDisplayActivityTypes()"
            [hasExercises]="exercises && exercises.length > 0"
            (dataChange)="handleFormChangeWrapper($event)">
          </app-activity-form>
        </div>
      </div>
    </div>
    
    <!-- Middle Column: JSON Template & Exercises -->
    <div class="middle-panel">
      <div class="panels-container">
        
        <!-- JSON Template Section -->
        <div class="panel-card template-card" 
             [class.template-expanded]="(activity.activityTypeId || 0) > 0">
          <div class="panel-header">
            <h2 class="panel-title">
              <mat-icon>code</mat-icon>
              JSON Template
            </h2>
            <button 
              mat-icon-button
              class="icon-button"
              (click)="handleCopyTemplate()"
              [disabled]="!(activity.activityTypeId || 0) || (activity.activityTypeId || 0) <= 0"
              matTooltip="Copy Template">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
          <div class="panel-body template-body">
            <div *ngIf="(activity.activityTypeId || 0) > 0; else noTemplate" class="template-content">
              <pre class="code-block"><code>{{ getActivityTemplate(activity.activityTypeId || 0) }}</code></pre>
            </div>
            <ng-template #noTemplate>
              <div class="empty-state">
                <mat-icon class="empty-icon">info</mat-icon>
                <p class="empty-text">Select an Activity Type to view its JSON template</p>
              </div>
            </ng-template>
          </div>
        </div>
        
        <!-- Exercises Section -->
        <div class="panel-card exercises-card">
          <div class="panel-header">
            <h2 class="panel-title">
              <mat-icon>fitness_center</mat-icon>
              Exercises
            </h2>
          </div>
          <div class="panel-body exercises-body">
            <app-exercise-editor
              [exercises]="exercises"
              [activityId]="activityId"
              [activityTypeId]="activity.activityTypeId || 0"
              [expandedExercise]="expandedExercise"
              (addExercise)="handleAddExercise()"
              (updateExercise)="handleUpdateExercise($event.exerciseId, $event.jsonData)"
              (deleteExercise)="handleDeleteExercise($event)"
              (previewExercise)="handlePreviewExercise($event)"
              (expansionChange)="expandedExercise = $event.isExpanded ? $event.index : false">
            </app-exercise-editor>
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- Right Column: Device Preview -->
    <div class="right-panel">
      <div class="panel-card">
        <div class="panel-header">
          <h2 class="panel-title">
            <mat-icon>preview</mat-icon>
            Device Preview
          </h2>
        </div>
        <div class="panel-body preview-body">
          <app-device-preview [activityData]="previewContent || activity"></app-device-preview>
        </div>
      </div>
    </div>
    
  </div>
</div>
