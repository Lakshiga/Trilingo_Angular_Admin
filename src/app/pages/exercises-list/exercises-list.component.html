<div class="exercises-page" *ngIf="numericActivityId">
  
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Back to Activities">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-text">
        <h1 class="page-title">Manage Exercises</h1>
        <p class="page-subtitle" *ngIf="activity">Activity: {{ getActivityTitle() }}</p>
      </div>
    </div>
    <button 
      mat-raised-button 
      color="primary" 
      class="add-button"
      (click)="handleAddExercise()" 
      [disabled]="isLoading">
      <mat-icon>add</mat-icon>
      Add Exercise
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading exercises...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="loadData()">Retry</button>
  </div>

  <!-- Exercises Table -->
  <div *ngIf="!isLoading && !error" class="table-container">
    <mat-card class="exercises-card">
      <mat-card-content class="card-content">
        

        <!-- Exercises Table -->
        <div class="table-wrapper">
          <table class="exercises-table">
            <thead>
              <tr>
                <th class="sequence-header">Sequence</th>
                <th class="preview-header">Preview</th>
                <th class="json-header">JSON Content</th>
                <th class="date-header">Created</th>
                <th class="actions-header">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let exercise of exercises" class="table-row">
                
                <!-- Sequence Order -->
                <td class="cell sequence-cell">
                  <div class="cell-value">
                    <span class="exercise-number">{{ exercise.sequenceOrder }}</span>
                  </div>
                </td>

                <!-- Preview -->
                <td class="cell preview-cell">
                  <button 
                    mat-raised-button 
                    color="primary"
                    (click)="handlePreview(exercise)"
                    matTooltip="Preview Exercise"
                    class="preview-button">
                    <mat-icon>visibility</mat-icon>
                    Preview
                  </button>
                </td>

                <!-- JSON Content -->
                <td class="cell json-cell">
                  <div class="json-snippet">
                    <code>{{ getJsonSnippet(exercise) }}</code>
                  </div>
                </td>

                <!-- Created At -->
                <td class="cell date-cell">
                  <div class="cell-value">{{ formatDate(exercise.createdAt) }}</div>
                </td>

                <!-- Actions -->
                <td class="cell actions-cell">
                  <div class="action-buttons">
                    <a 
                      mat-icon-button 
                      color="primary"
                      [routerLink]="['/activity-edit']"
                      [queryParams]="{activityId: activityId, editExerciseId: exercise.id}"
                      [disabled]="isLoading"
                      matTooltip="Edit Exercise">
                      <mat-icon>edit</mat-icon>
                    </a>
                    <button 
                      mat-icon-button 
                      color="warn"
                      (click)="deleteExercise(exercise)"
                      [disabled]="isLoading || exercises.length <= 1"
                      matTooltip="Delete">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Empty State -->
              <tr *ngIf="exercises.length === 0" class="empty-row">
                <td colspan="5" class="empty-cell">
                  <div class="empty-state">
                    <mat-icon>assignment_outline</mat-icon>
                    <p>No exercises found. Click "Add Exercise" to create one.</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </mat-card-content>
    </mat-card>
  </div>

</div>

<!-- Error Page -->
<div class="error-page" *ngIf="!numericActivityId">
  <mat-card class="error-card">
    <mat-card-content>
      <mat-icon class="error-icon-large">error_outline</mat-icon>
      <h2>Error: No Activity ID provided</h2>
      <p>Please select an activity to manage exercises.</p>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to Activities
      </button>
    </mat-card-content>
  </mat-card>
</div>

<!-- Exercise Preview Modal -->
<app-activity-player-modal
  [isOpen]="isPreviewOpen"
  [activity]="previewActivity"
  [isLoading]="false"
  (onClose)="closePreview()">
</app-activity-player-modal>
