<div class="exercise-editor">
  <mat-accordion multi="false">

      <mat-expansion-panel
          *ngFor="let exercise of paginatedExercises; let i = index"
          [expanded]="isPanelExpanded(i)"
          (opened)="handlePanelOpened(exercise, i)"
          (closed)="onExpansionChange(i, false)"
          class="mb-3 shadow border border-gray-200 rounded-xl"
      >

          <mat-expansion-panel-header>
              <mat-panel-title class="w-full">
                  <div class="flex justify-between items-center w-full">

                      <span class="font-medium text-gray-900">
                          Exercise #{{ getExerciseDisplayNumber(i) }} 
                          </span>

                      <div class="flex items-center gap-2">
                          <button
                              mat-raised-button
                              color="primary"
                              (click)="saveExercise(exercise)"
                              [disabled]="hasJsonError(exercise) || !editingExercises.has(exercise.id)"
                              class="!rounded-lg !px-4">
                              <mat-icon class="mr-1 text-base">save</mat-icon>
                              Save
                          </button>
                          <button
                              mat-stroked-button
                              color="warn"
                              (click)="onDeleteExercise(exercise, $event)"
                              class="!rounded-lg !px-4">
                              <mat-icon class="mr-1 text-base">delete</mat-icon>
                              Delete
                          </button>
                          
                          </div>
                  </div>
              </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="mt-3">
              <label class="block mb-1 text-gray-700 font-medium">
                  Exercise JSON
              </label>
              <mat-form-field appearance="outline" class="w-full">
                  <textarea
                      matInput
                      rows="15"
                      [ngModel]="getExerciseJson(exercise)"
                      (ngModelChange)="handleExerciseChange(exercise, $event)"
                      placeholder="Enter exercise JSON..."
                      class="font-mono text-sm"
                      [class.error]="hasJsonError(exercise)">
                  </textarea>
                  <mat-error *ngIf="hasJsonError(exercise)">
                      {{ getJsonError(exercise) }}
                  </mat-error>
              </mat-form-field>
          </div>

      </mat-expansion-panel>
  </mat-accordion>
  <div class="exercise-pagination" *ngIf="totalExercises > pageSize">
    <button
      mat-stroked-button
      color="primary"
      (click)="goToPreviousPage()"
      [disabled]="currentPage === 1">
      <mat-icon>chevron_left</mat-icon>
      Prev
    </button>
    <div class="page-info">
      <p>Showing {{ currentRange.start }} - {{ currentRange.end }} of {{ totalExercises }}</p>
      <span>Page {{ currentPage }} / {{ totalPages }}</span>
    </div>
    <button
      mat-stroked-button
      color="primary"
      (click)="goToNextPage()"
      [disabled]="currentPage === totalPages">
      Next
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  </div>