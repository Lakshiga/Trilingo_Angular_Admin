<mat-card class="exercise-editor p-3">
  <mat-card-header class="pb-2">
    <mat-card-title class="text-xl font-semibold">Exercises</mat-card-title>
  </mat-card-header>

  <mat-card-content class="flex-1 overflow-y-auto">
    <mat-accordion multi="false">

      <mat-expansion-panel
        *ngFor="let exercise of exercises; let i = index"
        [expanded]="expandedExercise === i"
        (opened)="onExpansionChange(i, true)"
        (closed)="onExpansionChange(i, false)"
        class="mb-3 shadow border border-gray-200 rounded-xl"
      >

        <!-- Header -->
        <mat-expansion-panel-header>
          <mat-panel-title class="w-full">
            <div class="flex justify-between items-center w-full">

              <span class="font-medium text-gray-900">
                Exercise #{{ i + 1 }}
              </span>

              <!-- ⭐ Save + Preview side-by-side -->
              <div class="flex items-center gap-2">

                <button
                  mat-stroked-button
                  color="primary"
                  (click)="onPreviewExercise(exercise, $event)"
                  [disabled]="hasJsonError(exercise)"
                  class="!rounded-lg !px-4"
                >
                  <mat-icon class="mr-1 text-base">visibility</mat-icon>
                  Preview
                </button>

                <button
                  mat-raised-button
                  color="primary"
                  (click)="saveExercise(exercise)"
                  [disabled]="hasJsonError(exercise)"
                  class="!rounded-lg !px-4"
                >
                  <mat-icon class="mr-1 text-base">save</mat-icon>
                  Save
                </button>

              </div>

            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <!-- JSON TEXTAREA -->
        <div class="mt-3">

          <!-- ⭐ Floating label remove → using normal label outside -->
          <label class="block mb-1 text-gray-700 font-medium">
            Exercise JSON
          </label>

          <mat-form-field appearance="outline" class="w-full">
            <textarea
              matInput
              rows="15"
              [ngModel]="getExerciseJson(exercise)"
              (ngModelChange)="handleExerciseChange(exercise, $event)"
              placeholder="Enter exercise JSON..."
              class="font-mono text-sm"
              [class.error]="hasJsonError(exercise)"
            >
            </textarea>

            <mat-error *ngIf="hasJsonError(exercise)">
              {{ getJsonError(exercise) }}
            </mat-error>
          </mat-form-field>

        </div>

      </mat-expansion-panel>
    </mat-accordion>

    <!-- ADD EXERCISE BUTTON -->
    <button
      mat-raised-button
      color="accent"
      (click)="onAddExercise()"
      class="w-full mt-3 py-2 text-base !rounded-xl flex items-center justify-center gap-2"
    >
      <mat-icon>add_circle_outline</mat-icon>
      Add Exercise
    </button>

  </mat-card-content>
</mat-card>
