<div class="p-4 sm:p-8 min-h-screen bg-gray-100 flex flex-col items-center w-full">

  <!-- Activity Header -->
  
  <header class="text-center mb-6 max-w-2xl w-full p-4 bg-white shadow-lg rounded-xl">
  <h1 class="text-3xl font-extrabold text-indigo-700 mb-1">{{ text(contentData?.title) }}</h1>
  <p class="text-gray-600 italic">{{ text(contentData?.instruction) }}</p>
  <div class="mt-3 text-sm font-semibold text-gray-700">
  Question {{ currentQuestionIndex() + 1 }} of {{ contentData?.questions?.length || 0 }} | Score: {{ score() }}
  </div>
  </header>
  
  @if (currentQuestion()) {
  <main class="max-w-2xl w-full space-y-6">
  
    <!-- 1. Question Card -->
    <section class="p-6 bg-white border-2 border-indigo-500 rounded-xl shadow-2xl">
      <div class="text-xl font-bold text-gray-800 mb-4 text-center">роХрпЗро│рпНро╡ро┐:</div>
      <div class="flex justify-center items-center p-4 min-h-20"
           [ngClass]="{'border border-dashed border-gray-300 rounded-lg bg-indigo-50': true}">
        
        <!-- Question Content Rendering -->
        @if (currentQuestion().question.type === 'text') {
          <p class="text-2xl text-center text-gray-900">{{ getQuestionContent() }}</p>
        } @else if (currentQuestion().question.type === 'image') {
          <img [src]="getQuestionContent() || getFallbackImage('image')" alt="Question Image" class="max-h-24 object-contain rounded-md shadow-md"/>
        } @else if (currentQuestion().question.type === 'audio') {
          <div class="audio-content cursor-pointer" (click)="playSound(currentQuestion().question.content, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.616 5.892a1 1 0 01-.616 1.624 7.001 7.001 0 000 6.974 1 1 0 01.616 1.624 9.001 9.001 0 000-10.222z" clip-rule="evenodd" />
              </svg>
              <span class="text-base font-medium mt-1">роХрпЗро│рпНро╡ро┐ропрпИ роЗропроХрпНроХро╡рпБроорпН</span>
          </div>
        }
        
      </div>
    </section>
  
    <!-- 2. Options Grid -->
    <section class="grid" [ngClass]="{
      'sm:grid-cols-2 gap-4': currentQuestion().answerType === 'text',
      'sm:grid-cols-3 gap-6': currentQuestion().answerType !== 'text' 
    }">
      @for (option of currentQuestion().options; track $index) {
        <button 
          (click)="selectOption($index)" 
          [disabled]="feedback() !== 'default'"
          class="option-card p-3 rounded-xl transition-all duration-200 transform shadow-md h-full min-h-[80px] flex items-center justify-center text-center focus:outline-none border-2"
          [ngClass]="{
            'bg-white text-gray-800 hover:bg-indigo-50 border-gray-200': userSelection() !== $index && feedback() === 'default',
            'bg-indigo-200 border-indigo-600 shadow-xl scale-[1.02]': userSelection() === $index && feedback() === 'default',
            'bg-green-300 border-green-700 shadow-xl': option.isCorrect && feedback() !== 'default',
            'bg-red-300 border-red-700 animate-shake shadow-xl': userSelection() === $index && !option.isCorrect && feedback() !== 'default',
            'opacity-60 pointer-events-none': feedback() !== 'default' && userSelection() !== $index && !option.isCorrect
          }"
        >
          <!-- Option Content (Uniform Type) -->
          @if (currentQuestion().answerType === 'text') {
            <span class="text-lg font-medium">{{ getOptionContent(option) }}</span>
          } @else if (currentQuestion().answerType === 'image') {
            <img [src]="getOptionContent(option) || getFallbackImage('image')" alt="Option Image" class="max-h-20 object-contain"/>
          } @else if (currentQuestion().answerType === 'audio') {
            <div class="audio-content cursor-pointer" (click)="playSound(option.content, $event)">
               <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" viewBox="0 0 20 20" fill="currentColor">
                 <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.616 5.892a1 1 0 01-.616 1.624 7.001 7.001 0 000 6.974 1 1 0 01.616 1.624 9.001 9.001 0 000-10.222z" clip-rule="evenodd" />
               </svg>
               <span class="text-sm font-medium mt-1">роТро▓ро┐ропрпИ роЗропроХрпНроХро╡рпБроорпН</span>
            </div>
          }
        </button>
      }
    </section>
    
    <!-- 3. Feedback and Action -->
    <footer class="text-center pt-4">
      @if (feedback() !== 'default' && feedback() !== 'completed') {
        <p class="text-xl font-bold p-3 rounded-lg shadow-md"
           [ngClass]="{
            'bg-green-100 text-green-800 border-green-400': feedback() === 'correct',
            'bg-red-100 text-red-800 border-red-400': feedback() === 'incorrect'
           }">
           @if (feedback() === 'correct') {
            роЪро░ро┐ропро╛рой ро╡ро┐роЯрпИ! ЁЯОЙ
           } @else {
            родро╡ро▒ро╛рой ро╡ро┐роЯрпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.
           }
        </p>
      }
  
      @if (feedback() !== 'default') {
        <button mat-flat-button color="primary" class="mt-4 p-4 text-lg font-semibold w-full sm:w-auto" (click)="goToNextQuestion()">
          {{ currentQuestionIndex() + 1 < contentData.questions.length ? 'роЕроЯрпБродрпНрод роХрпЗро│рпНро╡ро┐' : 'ро╡ро┐ро│рпИропро╛роЯрпНроЯрпИ роорпБроЯро┐роХрпНроХро╡рпБроорпН' }}
          <mat-icon>arrow_forward</mat-icon>
        </button>
      }
    </footer>
  </main>
  
  
  } @else if (feedback() === 'completed') {
  <!-- Game Completed Screen -->
  <div class="max-w-xl w-full text-center p-8 bg-white shadow-2xl rounded-xl">
  <h2 class="text-4xl font-extrabold text-green-600 mb-4">ро╡ро┐ро│рпИропро╛роЯрпНроЯрпБ роорпБроЯро┐роирпНродродрпБ!</h2>
  <p class="text-xl text-gray-700">роирпАроЩрпНроХро│рпН рокрпЖро▒рпНро▒ роородро┐рокрпНрокрпЖрогрпН: <span class="font-bold text-indigo-700">{{ score() }} / {{ contentData.questions.length }}</span></p>
  <button mat-raised-button color="accent" class="mt-6 p-4 text-lg" (click)="restartGame()">
  роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХро╡рпБроорпН <mat-icon>refresh</mat-icon>
  </button>
  </div>
  } @else {
  <p class="text-xl text-gray-500">родро░ро╡рпБ роПро▒рпНро▒рокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.</p>
  }
  
  </div>