<div class="p-4 sm:p-8 min-h-screen bg-gray-100 flex flex-col items-center w-full">

    @if (currentStoryData()) {
    <div class="max-w-4xl w-full bg-white shadow-2xl rounded-2xl overflow-hidden">
    
      <!-- Activity Header -->
      <header class="text-center p-6 bg-indigo-600 text-white border-b border-indigo-700">
        <h1 class="text-2xl font-bold">{{ text(content.title) }}</h1>
        <p class="text-sm italic">{{ text(content.instruction) }}</p>
      </header>
    
      <!-- Story Content Area -->
      <main class="p-6">
        
        <!-- Audio Element (Hidden) -->
        <!-- currentAudioUrl is a SafeUrl, correctly handled by Angular -->
        <audio #audioPlayer [src]="currentAudioUrl" style="display: none;" [autoplay]="false"></audio>
    
        <!-- 1. Image Display -->
        @if (currentScene()) {
            <div class="scene-image-container relative bg-gray-200 rounded-lg overflow-hidden shadow-xl mb-6">
                <img 
                    [src]="currentScene()!.imageUrl" 
                    [alt]="text(currentScene()!.content)" 
                    class="w-full object-cover transition-opacity duration-500 ease-in-out"
                    onerror="this.onerror=null; this.src='https://placehold.co/800x400/D1D5DB/4B5563?text=Image+Missing';"
                >
            </div>
        } @else {
             <div class="scene-image-container relative bg-gray-200 rounded-lg overflow-hidden shadow-xl mb-6 flex items-center justify-center h-[400px]">
                <p class="text-xl text-gray-500">Loading scene...</p>
             </div>
        }
    
        <!-- 2. Text Display -->
        <div class="story-text-box p-4 border-l-4 border-indigo-500 bg-indigo-50 rounded-r-lg mb-6 min-h-[80px]">
            <p class="text-xl text-gray-800 font-medium transition-all duration-500">
                @if (currentScene()) {
                    {{ text(currentScene()!.content) }}
                } @else {
                    {{ text(currentStoryData()!.title) }}
                }
            </p>
        </div>
    
        <!-- 3. Controls -->
        <div class="flex items-center justify-between space-x-4 mb-4">
          <span class="text-sm font-mono text-gray-600">{{ formatTime(currentTime()) }}</span>
          
          <input 
            type="range" 
            min="0" 
            [max]="duration()" 
            [value]="currentTime()" 
            (input)="seek($event)"
            class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer range-lg"
          >
          
          <span class="text-sm font-mono text-gray-600">{{ formatTime(duration()) }}</span>
        </div>
    
        <div class="flex justify-center mb-6">
          <button mat-fab color="primary" (click)="togglePlay()" aria-label="Play/Pause">
            <mat-icon>{{ isPlaying() ? 'pause' : 'play_arrow' }}</mat-icon>
          </button>
        </div>
      </main>
    </div>
    
    
    } @else {
    <p class="text-xl text-gray-500 p-8">தரவு ஏற்றப்படவில்லை அல்லது கதைத் தரவு காணவில்லை.</p>
    }
    
    </div>