<div class="activity-types-page">
  
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Manage Activity Types</h1>
        <p class="page-subtitle">Manage activity type categories</p>
      </div>
    </div>
    <button 
      mat-raised-button 
      color="primary" 
      class="add-button"
      (click)="startAdding()" 
      [disabled]="isAdding || editRowId !== null || isLoading">
      <mat-icon>add</mat-icon>
      Add Activity Type
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading activity types...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="loadActivityTypes()">Retry</button>
  </div>

  <!-- Add New Activity Type Row (Outside table for better visibility) -->
  <div *ngIf="isAdding" class="add-row-container">
    <mat-card class="activity-types-card">
      <mat-card-content class="card-content">
        <div class="add-row">
          <div class="row-content">
            <div class="cell id-cell">
              <div class="cell-value">New</div>
            </div>
            <div class="cell main-activity-cell">
              <mat-form-field appearance="outline" class="edit-field">
                <mat-label>Main Activity</mat-label>
                <mat-select 
                  [(ngModel)]="selectedMainActivityId"
                  required>
                  <mat-option [value]="null">Select Main Activity</mat-option>
                  <mat-option 
                    *ngFor="let mainActivity of mainActivities" 
                    [value]="mainActivity.id">
                    {{ mainActivity.name_en || mainActivity.name_ta || mainActivity.name_si }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="cell name-en-cell">
              <mat-form-field appearance="outline" class="edit-field">
                <input 
                  matInput 
                  [(ngModel)]="newActivityType.name_en"
                  placeholder="English Name"
                  class="!text-base">
              </mat-form-field>
            </div>
            <div class="cell name-ta-cell">
              <mat-form-field appearance="outline" class="edit-field">
                <input 
                  matInput 
                  [(ngModel)]="newActivityType.name_ta"
                  placeholder="தமிழ் Name"
                  class="!text-base">
              </mat-form-field>
            </div>
            <div class="cell name-si-cell">
              <mat-form-field appearance="outline" class="edit-field">
                <input 
                  matInput 
                  [(ngModel)]="newActivityType.name_si"
                  placeholder="සිංහල Name"
                  class="!text-base">
              </mat-form-field>
            </div>
            <div class="cell actions-cell">
              <div class="action-buttons">
                <button 
                  mat-icon-button 
                  color="primary"
                  (click)="saveActivityType()"
                  [disabled]="(!newActivityType.name_en && !newActivityType.name_ta && !newActivityType.name_si) || !selectedMainActivityId"
                  matTooltip="Save">
                  <mat-icon>check</mat-icon>
                </button>
                <button 
                  mat-icon-button 
                  (click)="cancelEdit()"
                  matTooltip="Cancel">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Activity Types Table -->
  <div *ngIf="!isLoading && !error" class="table-container">
    <mat-card class="activity-types-card">
      <mat-card-content class="card-content">
        <div class="table-wrapper">
          <table class="activity-types-table">
            <thead>
              <tr>
                <th class="id-header">ID</th>
                <th class="main-activity-header">Main Activity</th>
                <th class="name-en-header">English Name</th>
                <th class="name-ta-header">தமிழ் Name</th>
                <th class="name-si-header">සිංහල Name</th>
                <th class="actions-header">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let type of activityTypes" class="table-row" [class.editing]="editRowId === type.id">
                
                <!-- ID -->
                <td class="cell id-cell">
                  <div class="cell-value">
                    {{ type.id }}
                  </div>
                </td>

                <!-- Main Activity -->
                <td class="cell main-activity-cell">
                  <div *ngIf="editRowId !== type.id" class="cell-value">
                    {{ getMainActivityName(type.mainActivityId) }}
                  </div>
                  <mat-form-field *ngIf="editRowId === type.id" appearance="outline" class="edit-field">
                    <mat-label>Main Activity</mat-label>
                    <mat-select 
                      [(ngModel)]="editedMainActivityId">
                      <mat-option 
                        *ngFor="let mainActivity of mainActivities" 
                        [value]="mainActivity.id">
                        {{ mainActivity.name_en || mainActivity.name_ta || mainActivity.name_si }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>

                <!-- English Name -->
                <td class="cell name-en-cell">
                  <div *ngIf="editRowId !== type.id" class="cell-value">
                    {{ type.name_en }}
                  </div>
                  <mat-form-field *ngIf="editRowId === type.id" appearance="outline" class="edit-field">
                    <input 
                      matInput 
                      [(ngModel)]="editedActivityType!.name_en"
                      placeholder="English Name"
                      class="!text-base">
                  </mat-form-field>
                </td>

                <!-- Tamil Name -->
                <td class="cell name-ta-cell">
                  <div *ngIf="editRowId !== type.id" class="cell-value">
                    {{ type.name_ta }}
                  </div>
                  <mat-form-field *ngIf="editRowId === type.id" appearance="outline" class="edit-field">
                    <input 
                      matInput 
                      [(ngModel)]="editedActivityType!.name_ta"
                      placeholder="தமிழ் Name"
                      class="!text-base">
                  </mat-form-field>
                </td>

                <!-- Sinhala Name -->
                <td class="cell name-si-cell">
                  <div *ngIf="editRowId !== type.id" class="cell-value">
                    {{ type.name_si }}
                  </div>
                  <mat-form-field *ngIf="editRowId === type.id" appearance="outline" class="edit-field">
                    <input 
                      matInput 
                      [(ngModel)]="editedActivityType!.name_si"
                      placeholder="සිංහල Name"
                      class="!text-base">
                  </mat-form-field>
                </td>

                <!-- Actions -->
                <td class="cell actions-cell">
                  <div *ngIf="editRowId !== type.id" class="action-buttons">
                    <button 
                      mat-icon-button 
                      color="primary"
                      (click)="startEditing(type)"
                      [disabled]="isAdding || isLoading"
                      matTooltip="Edit">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button 
                      mat-icon-button 
                      color="warn"
                      (click)="deleteActivityType(type)"
                      [disabled]="isAdding || isLoading"
                      matTooltip="Delete">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                  <div *ngIf="editRowId === type.id" class="action-buttons">
                    <button 
                      mat-icon-button 
                      color="primary"
                      (click)="saveActivityType(type)"
                      [disabled]="!editedActivityType?.name_en && !editedActivityType?.name_ta && !editedActivityType?.name_si"
                      matTooltip="Save">
                      <mat-icon>check</mat-icon>
                    </button>
                    <button 
                      mat-icon-button 
                      (click)="cancelEdit()"
                      matTooltip="Cancel">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Empty State -->
              <tr *ngIf="activityTypes.length === 0 && !isAdding" class="empty-row">
                <td colspan="6" class="empty-cell">
                  <div class="empty-state">
                    <mat-icon>extension_outline</mat-icon>
                    <p>No activity types found. Click "Add Activity Type" to create one.</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </mat-card-content>
    </mat-card>
  </div>

</div>
