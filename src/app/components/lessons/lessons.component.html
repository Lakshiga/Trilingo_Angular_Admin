<div class="lessons-page-wrapper">
      <mat-card class="lessons-card rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
        <mat-card-header class="bg-gradient-to-r from-indigo-50 to-purple-50 px-6 py-4 border-b border-gray-200">
          <button 
            mat-button 
            (click)="goBack(); $event.preventDefault(); $event.stopPropagation();" 
            class="back-to-levels-button text-indigo-600 hover:text-indigo-800 transition-colors duration-200">
            <mat-icon>arrow_back</mat-icon>
            Back to Levels
          </button>
          
          <button mat-raised-button 
                  class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5"
                  (click)="openAddLessonDialog()"
                  [disabled]="isLoading">
            <mat-icon>add</mat-icon>
            Add Lessons
          </button>
        </mat-card-header>
        
        <mat-card-content class="p-0">
          <div *ngIf="isLoading" class="loading-container flex justify-center items-center p-12">
            <mat-spinner></mat-spinner>
          </div>

          <div *ngIf="error" class="error-message p-6 text-center">
            <p class="text-red-600 mb-4">{{ error }}</p>
            <button mat-button color="primary" (click)="loadLessons()">Retry</button>
          </div>

          <div *ngIf="!isLoading && !error" class="table-container">
            <table mat-table [dataSource]="lessons" class="lessons-table">
            <!-- ID Column -->
            <ng-container matColumnDef="lessonId">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let lesson">{{ lesson.lessonId }}</td>
            </ng-container>

            <!-- Lesson Name Column -->
            <ng-container matColumnDef="lessonName">
              <th mat-header-cell *matHeaderCellDef>Lesson Name</th>
              <td mat-cell *matCellDef="let lesson">{{ getDisplayText(lesson.lessonName) }}</td>
            </ng-container>

            <!-- Sequence Order Column -->
            <ng-container matColumnDef="sequenceOrder">
              <th mat-header-cell *matHeaderCellDef>Sequence Order</th>
              <td mat-cell *matCellDef="let lesson">{{ lesson.sequenceOrder }}</td>
            </ng-container>

            <!-- Manage Activities Column -->
            <ng-container matColumnDef="manageActivities">
              <th mat-header-cell *matHeaderCellDef>Manage Activities</th>
              <td mat-cell *matCellDef="let lesson">
                <button mat-button 
                        color="primary" 
                        (click)="manageActivities(lesson)" 
                        [disabled]="isLoading"
                        class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-medium rounded-full px-4 py-2 transition-colors duration-200">
                  MANAGE ACTIVITIES
                </button>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let lesson">
                <div class="flex space-x-2">
                  <button mat-icon-button 
                          (click)="editLesson(lesson)" 
                          color="primary"
                          [disabled]="isLoading"
                          class="bg-indigo-100 hover:bg-indigo-200 text-indigo-600 rounded-full p-2 transition-colors duration-200">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button 
                          (click)="deleteLesson(lesson)" 
                          color="warn"
                          [disabled]="isLoading"
                          class="bg-red-100 hover:bg-red-200 text-red-600 rounded-full p-2 transition-colors duration-200">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
                class="bg-white hover:bg-gray-50 transition-colors duration-150"></tr>
          </table>
          </div>

          <div class="no-data text-center p-12 text-gray-500" *ngIf="!isLoading && !error && lessons.length === 0">
            <p>No lessons found. Create your first lesson!</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Add/Edit Lesson Dialog -->
    <div class="dialog-overlay" *ngIf="showDialog" (click)="closeDialog()">
      <div class="dialog-content" (click)="$event.stopPropagation()">
        <div class="dialog-header">
          <h3>{{ isEditing ? 'Edit Lesson' : 'Add New Lesson' }}</h3>
          <button mat-icon-button (click)="closeDialog()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
    
        <form class="lesson-dialog-form" (ngSubmit)="saveLesson()">
          <app-multilingual-form
            [title]="dialogTitle"
            [fieldLabel]="'Lesson Name'"
            [showDescription]="false"
            [showActions]="false"
            [initialData]="lessonFormData"
            (dataChange)="onLessonFormDataChange($event)">
          </app-multilingual-form>

          <div class="sequence-section">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Sequence Order</mat-label>
              <input
                matInput
                type="number"
                min="1"
                name="sequenceOrder"
                [(ngModel)]="currentLesson.sequenceOrder"
                required>
            </mat-form-field>
            <p class="sequence-helper">
              Determines the lesson position within the selected level.
            </p>
          </div>

          <div class="dialog-actions">
            <button mat-stroked-button type="button" (click)="closeDialog()" [disabled]="isSaving">
              Cancel
            </button>
            <button mat-flat-button color="primary" type="submit" [disabled]="isSaving">
              <mat-spinner *ngIf="isSaving" diameter="18"></mat-spinner>
              <span *ngIf="!isSaving">{{ isEditing ? 'Update' : 'Add' }} Lesson</span>
            </button>
          </div>
        </form>
      </div>
    </div>
    