<!-- SECURITY: Show loading screen during initial auth check to prevent content flash -->
<ng-container *ngIf="isInitializing; else contentArea">
  <div class="auth-loading-screen flex items-center justify-center h-screen w-full bg-slate-50 dark:bg-slate-900">
    <div class="text-center">
      <mat-spinner diameter="50" class="mx-auto mb-4"></mat-spinner>
      <p class="text-gray-600 dark:text-gray-400">Verifying authentication...</p>
    </div>
  </div>
</ng-container>

<!-- Main Content Area: Only shown after auth check completes -->
<ng-template #contentArea>
  <!-- Public Routes: Show without navbar -->
  <ng-container *ngIf="isPublicRoute; else adminLayout">
    <router-outlet />
  </ng-container>

  <!-- Admin Layout: Show with navbar ONLY for authenticated users -->
  <ng-template #adminLayout>
    <!-- SECURITY: Double check - Only show admin layout if authenticated -->
    <ng-container *ngIf="isAuthenticated$ | async; else redirectToLogin">
      <div class="admin-layout flex flex-col h-screen w-full bg-slate-50 dark:bg-slate-900 transition-colors duration-300 overflow-hidden">
        <!-- Navbar Component -->
        <app-navbar></app-navbar>

        <!-- Main Content -->
        <div class="content-wrapper flex flex-1 w-full overflow-hidden">
          <main class="main-content flex-1 w-full p-4 sm:p-6 overflow-y-auto scrollbar-hide bg-white">
            <router-outlet />
          </main>
        </div>

        <!-- Chatbot Component - Available on all admin pages -->
        <app-chatbot></app-chatbot>
      </div>
    </ng-container>

    <!-- SECURITY: If not authenticated, show nothing (AuthGuard will redirect) -->
    <ng-template #redirectToLogin>
      <div class="auth-loading-screen flex items-center justify-center h-screen w-full bg-slate-50 dark:bg-slate-900">
        <div class="text-center">
          <mat-spinner diameter="50" class="mx-auto mb-4"></mat-spinner>
          <p class="text-gray-600 dark:text-gray-400">Redirecting to login...</p>
        </div>
      </div>
    </ng-template>
  </ng-template>
</ng-template>
